<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Qu·∫£n l√Ω Thi·ªáp M·ªùi</title>
  <link rel="stylesheet" href="admin.css">
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      padding: 20px;
      background: #fafafa;
      color: #333;
    }
    h2 {
      color: #c2185b;
      margin-bottom: 10px;
    }
    .info-form, .rsvp-list {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      margin-bottom: 40px;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .label {
      font-weight: bold;
    }
    label {
      margin-right: 10px;
    }
    button {
      background-color: #c2185b;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 1rem;
    }
    button:hover {
      background-color: #ad1457;
    }
    #result {
      margin-top: 15px;
      background: #fff;
      border-radius: 10px;
      padding: 10px 15px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .result-item {
      margin-bottom: 10px;
    }
    .rsvp-list table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    .rsvp-list th, .rsvp-list td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    .rsvp-list th {
      background-color: #f06292;
      color: white;
    }
  </style>
</head>
<body>

  <!-- =================== PH·∫¶N 1: T·∫†O LINK THI·ªÜP M·ªúI =================== -->
  <div class="info-form" id="infoForm">
    <h2>üéâ Nh·∫≠p th√¥ng tin kh√°ch m·ªùi</h2>

    <input type="text" id="guestName" placeholder="Nh·∫≠p t√™n kh√°ch" required>

    <div class="form-group">
      <p class="label">Quan h·ªá v·ªõi ch√∫ r·ªÉ?</p>
      <label><input type="radio" name="relation" value="B·∫°n"> B·∫°n</label>
      <label><input type="radio" name="relation" value="Anh"> Anh</label>
      <label><input type="radio" name="relation" value="Ch·ªã"> Ch·ªã</label>
      <label><input type="radio" name="relation" value="Em"> Em</label>
      <label><input type="radio" name="relation" value="Ch√∫"> Ch√∫</label>
      <label><input type="radio" name="relation" value="C√¥"> C√¥</label>
      <label><input type="radio" name="relation" value="C·∫≠u"> C·∫≠u</label>
      <label><input type="radio" name="relation" value="D√¨"> D√¨</label>
      <label><input type="radio" name="relation" value="M·ª£"> M·ª£</label>
      <label><input type="radio" name="relation" value="B√°c"> B√°c</label>
    </div>

    <div class="form-group">
      <p class="label">Kh√°ch m·ªùi c√≥ g√¨ ch∆∞a?</p>
      <label><input type="radio" name="partner" value=" + V·ª£"> V·ª£</label>
      <label><input type="radio" name="partner" value=" + Ch·ªìng"> Ch·ªìng</label>
      <label><input type="radio" name="partner" value=" + Ng∆∞·ªùi y√™u"> NY</label>
      <label><input type="radio" name="partner" value=" "> Ch∆∞a</label>
    </div>

    <button id="confirmBtn">T·∫°o Link Thi·ªáp M·ªùi</button>
    <div id="result"></div>
  </div>

  <!-- =================== PH·∫¶N 2: DANH S√ÅCH KH√ÅCH PH·∫¢N H·ªíI =================== -->
  <div class="rsvp-list">
    <h2>üìã Danh s√°ch kh√°ch x√°c nh·∫≠n & l·ªùi ch√∫c</h2>
    <table id="rsvpTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>T√™n</th>
          <th>Tham d·ª±</th>
          <th>L·ªùi ch√∫c</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="refreshBtn">üîÑ L√†m m·ªõi danh s√°ch</button>
    <button id="exportBtn">üì¶ Xu·∫•t Excel</button>
  </div>

  <!-- =================== SCRIPT =================== -->
  <script>
    // === PH·∫¶N 1: T·∫†O LINK THI·ªÜP M·ªúI ===
    document.getElementById("confirmBtn").addEventListener("click", function() {
      const name = document.getElementById("guestName").value.trim();
      const relation = document.querySelector("input[name='relation']:checked")?.value || "";
      const partner = document.querySelector("input[name='partner']:checked")?.value || "";

      if (!name) {
        alert("Vui l√≤ng nh·∫≠p t√™n kh√°ch!");
        return;
      }

      const fullName = relation + " " + name + partner;
      const url = `${window.location.origin}/index.html?guest=${encodeURIComponent(fullName)}`;

      document.getElementById("result").innerHTML = `
        <div class="result-item">
          <p>Link d√†nh cho kh√°ch <b>${fullName}</b>:</p>
          <a href="${url}" target="_blank">${url}</a>
        </div>
      `;
    });

    // === PH·∫¶N 2: L·∫§Y DANH S√ÅCH KH√ÅCH X√ÅC NH·∫¨N ===
    async function loadRSVP() {
      try {
        const res = await fetch("/api/rsvp");
        const data = await res.json();

        const tbody = document.querySelector("#rsvpTable tbody");
        tbody.innerHTML = "";

        if (data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="4">Ch∆∞a c√≥ d·ªØ li·ªáu n√†o</td></tr>`;
          return;
        }

        data.forEach((row) => {
          tbody.innerHTML += `
            <tr>
              <td>${row.id}</td>
              <td>${row.name}</td>
              <td>${row.attend}</td>
              <td>${row.message}</td>
            </tr>
          `;
        });
      } catch (err) {
        console.error(err);
        alert("‚ùå Kh√¥ng th·ªÉ t·∫£i danh s√°ch! Ki·ªÉm tra l·∫°i server Node.js nh√©.");
      }
    }

    document.getElementById("refreshBtn").addEventListener("click", loadRSVP);

    document.getElementById("exportBtn").addEventListener("click", async () => {
      const res = await fetch("/api/export");
      if (res.ok) {
        alert("‚úÖ ƒê√£ xu·∫•t file RSVP_List.xlsx th√†nh c√¥ng!");
      } else {
        alert("‚ùå L·ªói khi xu·∫•t file!");
      }
    });

    // T·ª± ƒë·ªông t·∫£i danh s√°ch khi m·ªü trang
    loadRSVP();
  </script>
</body>
</html>
